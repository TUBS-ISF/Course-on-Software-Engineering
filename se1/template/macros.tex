% TYPICAL COMMANDS FOR LECTURES

\renewcommand{\emph}[1]{{\color{blue}\textbf{#1}}}
%\ifdarkmode
%	\renewcommand{\emph}[1]{{\color{orange}\textbf{#1}}} % workaround for better readability
%\fi

\newcommand{\deutsch}[1]{{\color{gray}(#1)}}
\ifdarkmode
	\renewcommand{\deutsch}[1]{{\color{lightgray}(#1)}}
\fi
\newcommand{\deutschertitel}[1]{{\tiny\deutsch{#1}}}

\newcommand{\mycite}[1]{``#1''}
\newcommand{\mycitebegin}{``}
\newcommand{\myciteend}{''}
\newcommand{\mytitlesource}[1]{{\tiny\normalfont\mbox{[#1]}}}
\newcommand{\mysource}[1]{\ifthenelse{\equal{#1}{}}{}{\phantom{.}~\hfill~\mytitlesource{#1}}}
\newcommand{\mychapter}[1]{, Chapter~#1}
\newcommand{\mysection}[1]{, Section~#1}
\newcommand{\mypage}[1]{, p.~#1}
\newcommand{\mypages}[1]{, pp.~#1}

%\newcommand{\todo}[1]{{\color{red}\textbf{[#1]}}}
%\newcommand{\fodo}[1]{\todo{\footnote{\todo{#1}}}}
%\newcommand{\todots}{\todo{\ldots}}

\newcommand{\textheightoftitle}{.125\textheight}
\newcommand{\textheightwithtitle}{.825\textheight}
\newcommand{\textheightwithouttitle}{.95\textheight}

\newcommand{\lessonslearned}[3]{
	\subsection{Summary}
	\begin{frame}{\insertsection{} -- \myframetitle}
		\begin{fancycolumns}[animation=none]
			\begin{definition}{Lessons Learned}
				\begin{itemize}
					#1
				\end{itemize}
			\end{definition}
			\uncover<2->{\begin{note}{Further Reading}
				\small % references take space, can be a little smaller
				\begin{itemize}
					#2
				\end{itemize}
			\end{note}}
		\nextcolumn
			\uncover<3->{\begin{example}{Practice}
				#3
			\end{example}}
		\end{fancycolumns}
	\end{frame}
}

% TODO would be great to also show the section titles on this slide, but not sure how to do this
\newcommand{\faq}[3]{
	\subsection{FAQ}
	\begin{frame}{\emph{FAQ} -- \insertsubtitle{}}
		\small 
		\begin{fancycolumns}[t,columns=3,widths={33,33,33},animation=none]
			\emph{\large Lecture~\insertlecturenumber\parta}
			\begin{itemize}
				#1
			\end{itemize}
		\nextcolumn
			\emph{\large Lecture~\insertlecturenumber\partb}
			\begin{itemize}
				#2
			\end{itemize}
		\nextcolumn
			\emph{\large Lecture~\insertlecturenumber\partc}
			\begin{itemize}
				#3
			\end{itemize}
		\end{fancycolumns}
	\end{frame}
}

% REFERENCES TO OTHER LECTURES

\newcommand{\emphifequal}[3]{\ifthenelse{\equal{#1}{#2}}{\bfseries}{}\hyperlink{lecture#2}{#3}}

\newcommand{\reflecture}[1]{\hyperlink{lecture#1}{Lecture~#1}}
\newcommand{\parta}{a}
\newcommand{\partb}{b}
\newcommand{\partc}{c}
% TODO how to handle different numberings for different universities?

% COMMANDS FOR PROPOSITIONAL FORMULAS AND MATHEMATICAL NOTATIONS

\newcommand{\sem}[1]{\ensuremath{\llbracket #1 \rrbracket}} % semantics brackets
\newcommand{\pand}{\wedge} % conjunction
\newcommand{\por}{\vee} % disjunction
\newcommand{\pnot}{\neg} % negation
\newcommand{\pequals}{\leftrightarrow} % biconditional
\newcommand{\npequals}{\nleftrightarrow} % exclusive disjunction
\newcommand{\mequals}{\Leftrightarrow} % equivalence (meta-level)
\newcommand{\pimplies}{\rightarrow} % conditional
\newcommand{\mimplies}{\Rightarrow} % implication (meta-level)
\newcommand{\defeq}{\vcentcolon=} % defining equals
\newcommand{\power}[1]{\mathcal{P}(#1)} % power set
\newcommand{\refslide}[1]{\hyperlink{#1}{(see Slide \autoref{#1})}} % link to slide
\newcommand{\fs}[1]{\ensuremath{{\color{green}#1}}} % selected feature
\newcommand{\fd}[1]{\ensuremath{{\color{red}#1}}} % deselected feature
\newcommand{\clause}[1]{\ensuremath{{\color{red}#1}}} % clause in a CNF
\newcommand{\cfg}[3][0]{\ensuremath({{\only<#1>{\color{green}}\{#2\}}, {\only<#1>{\color{red}}\{#3\}})}} % configuration

\usepackage{mathtools} % required for absolute value in modeling lecture
\DeclarePairedDelimiter\abs{\lvert}{\rvert} % absolute value

% COMMANDS TO INCLUDE XKCDs AND PICS

\newcommand{\xkcd}[2]{\picDark[#2]{xkcd/#1}}
\newcommand{\xkcdframe}[1]{
	\begin{frame}
		\centering%
		\xkcd{#1}{height=80mm}
	\end{frame}
}
\newcommand{\widexkcdframe}[1]{
	\begin{frame}
		\xkcd{#1}{width=\linewidth}
	\end{frame}
}

\newcommand{\pictureframe}[2]{
	{
		\usebackgroundtemplate{#1}
		\begin{frame}[plain]
			#2
		\end{frame}
	}
}

% COMMANDS TO SIMPLIFY USAGE OF THE PROJECT CARTOON

\newcommand{\projectcartoonwidth}{.18} % default value for 5 tiles
\newcommand{\projectcartoon}[2]{\projectcartoonimage{sepia/cell_#1}{#2}}
\newcommand{\hprojectcartoon}[2]{\projectcartoonimage{alpha/cell_#1}{#2}}
\newcommand{\projectcartoonimage}[2]{
	\begin{minipage}[t]{\projectcartoonwidth\linewidth}
		\centering
		\pic[width=\linewidth]{projectcartoon/#1}\\#2
	\end{minipage}\hfill
}
\newcommand{\waterfallcartoon}{
	\hprojectcartoon{02}{Analysis}%
	\hprojectcartoon{03}{Design}%
	\hprojectcartoon{04}{Implementation}%
	\hprojectcartoon{05}{Testing}%
	\hprojectcartoon{10}{Maintenance}%
}
%\uncover<1->{\hprojectcartoon{01}{how the customer explained it}} % requirements
%\uncover<1->{\hprojectcartoon{02}{how the project leader understood it}} % modeling
%\uncover<1->{\hprojectcartoon{03}{how the analyst designed it}} % architecture and design
%\uncover<1->{\hprojectcartoon{04}{how the programmer implemented it}} % implementation
%\uncover<1->{\hprojectcartoon{05}{what the beta testers received}} % testing
%\uncover<1->{\hprojectcartoon{06}{how the business consultant described it}} % process
%\uncover<1->{\hprojectcartoon{07}{how the project was documented}} % documentation?
%\uncover<1->{\hprojectcartoon{08}{what operations installed}} % devops/continuous integration?
%\uncover<1->{\hprojectcartoon{09}{how the customer was billed}} % management (pricing)
%\uncover<1->{\hprojectcartoon{10}{how it was supported}} % maintenance
%\uncover<1->{\hprojectcartoon{11}{what marketing advertised}} % product lines. marketing? reuse?
%\uncover<1->{\hprojectcartoon{12}{when it was delivered}} % configuration management. continous delivery?
%\uncover<1->{\hprojectcartoon{13}{what the customer really needed}} % customer / SE II
%\uncover<1->{\hprojectcartoon{14}{what the digg effect can do to your site}} % ???
%\uncover<1->{\hprojectcartoon{15}{the disaster recover plan}} % ???
%\uncover<1->{\hprojectcartoon{16}{the open source version}} % open source (licensing)
%\uncover<1->{\hprojectcartoon{17}{how it performed under load}} % compilation and static analyses. quality assurance? performance?
%\uncover<1->{\hprojectcartoon{18}{how patches were applied}} % evolution

% COMMANDS BASED ON TIKZ

\newcommand{\mglass}[1]{
	\scalebox{#1}{
		\begin{tikzpicture}[overlay]
			\node[circle,draw=gray,line width=1,fill=blue,fill opacity=.2,inner sep=2mm] {} edge[draw=gray,line width=1,double distance=1pt,shorten <= -.2pt] (.33,-.33);
		\end{tikzpicture}
	}
}

\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;}

\newcommand{\correct}{%
	\begin{tikzpicture}[yscale=.1,xscale=.1,xshift=20,yshift=-10,overlay]
		\draw[line width=3,line join=bevel] (0,1) to [bend left=30] (1,0) to [bend left=15] (3,3);
		\draw[line width=2,line join=bevel,green] (0,1) to [bend left=30] (1,0) to [bend left=15] (3,3);
	\end{tikzpicture}%
}
\newcommand{\alsocorrect}{%
	\begin{tikzpicture}[yscale=.1,xscale=.1,xshift=20,yshift=-10,overlay]
		\draw[line width=3,line join=bevel] (0,1) to [bend left=30] (1,0) to [bend left=15] (3,3);
		\draw[line width=2,line join=bevel,orange] (0,1) to [bend left=30] (1,0) to [bend left=15] (3,3);
	\end{tikzpicture}%
}
\newcommand{\wrong}{%
	\begin{tikzpicture}[yscale=.1,xscale=.1,xshift=20,yshift=-10,overlay]
		\draw[line width=3,line join=bevel] (0,2) to [bend left=5] (2,0) (0,0) to [bend left=15] (2,2);
		\draw[line width=2,line join=bevel,red] (0,2) to [bend left=5] (2,0) (0,0) to [bend left=15] (2,2);
	\end{tikzpicture}%
}

% reusable tikz pictures
\tikzset{
	versioncontrol/.style={xscale=.55,font=\footnotesize,auto,knoten/.style={circle,inner sep=0,outer sep=0},
		kante/.style={overlay,->,thick,bend right=5,shorten >=-5pt,shorten <=-5pt},
		innerekante/.style={overlay,->,thick,bend right=60,shorten >=-10pt,shorten <=-10pt}}
}
\newcommand{\clientserver}[7]{
	\begin{center}
		\begin{tikzpicture}[versioncontrol]
			\node[knoten] (server) at (0,0) {\picDark[scale=.15]{versioncontrol/#1} \pic[scale=.3]{versioncontrol/tonne}};
			\node[knoten] (client1) at (-3,-2) {~~~~~\picDark[scale=.1]{versioncontrol/#2}~~~~~};
			\node[knoten] (client2) at (3,-2) {~~~~~\picDark[scale=.1]{versioncontrol/#3}~~~~~};
			#7
			\node[overlay] at (0,.8) {#4};
			\node[overlay] at (-3,-2.65) {#5};
			\node[overlay] at (3,-2.65) {#6};
		\end{tikzpicture}
	\end{center}
}

%scale 0.15 = 30pt
\newcommand{\peertopeer}[8]{
	\vspace{-2mm}
	\begin{center}
		\begin{tikzpicture}[versioncontrol]
			\node[knoten] (server) at (0,0) {\picDark[height=30pt]{versioncontrol/#1} \pic[height=20pt]{versioncontrol/#2}};
			\node[knoten] (client1) at (-3,-2) {\picDark[height=20pt]{versioncontrol/#3} \pic[height=15pt]{versioncontrol/#2}};
			\node[knoten] (client2) at (3,-2) {\picDark[height=20pt]{versioncontrol/#4} \pic[height=15pt]{versioncontrol/#2}};
			\node[knoten] (client21) at (3.6,-1.75) {};
			#8
			\node[above = -12pt of server, overlay] {#5};
			\node[text width = 0.45\linewidth, align = center, below = 2pt of client1, overlay] {#6};
			\node[text width = 0.45\linewidth, align = center, below = 2pt of client2, overlay] {#7};
		\end{tikzpicture}
	\end{center}
	\vspace{5mm}
}

\newcommand{\trunkbranch}[2]{
	\begin{tikzpicture}[auto,xscale=.75,font=\footnotesize,trunk/.style={circle,draw,thick,minimum size=2mm,inner sep=0mm,outer sep=.5mm},branch1/.style={trunk,fill=blue,yshift=1cm},branch2/.style={trunk,fill=blue,yshift=2cm},change/.style={overlay,->,thick},main/.style={trunk}, branch/.style={change#1},merge/.style={change#2}]
		\node[main,label=below:r1,label=left:main] at (0,0) (rev1) {};
		\node[branch1,label=above:r2] at (1,0) (rev2) {};
		\node[branch1,label=above:r3] at (2,0) (rev3) {};
		\node[main,label=below:r4] at (3,0) (rev4) {};
		\node[branch2,label=above:r5,label=left:a branch] at (4,0) (rev5) {};
		\node[branch1,label=above:r6] at (5,0) (rev6) {};
		\node[branch1,label=above:r7] at (6,0) (rev7) {};
		\node[branch2,label=above:r8] at (7,0) (rev8) {};
		\node[main,label=below:r9] at (8,0) (rev9) {};
		\node[branch2,label=above:r10] at (9,0) (rev10) {};
		\node[main,label=below:r11] at (10,0) (rev11) {};
		\node[main,label=below:r12] at (11,0) (rev12) {};
		\node[branch2,label=above:r13] at (12,0) (rev13) {};
		\draw[branch] (rev1) to (rev2);
		\draw[change] (rev1) to (rev4);
		\draw[change] (rev2) to (rev3);
		\draw[merge] (rev3) to (rev4);
		\draw[branch] (rev4) to (rev5);
		\draw[branch] (rev4) to (rev6);
		\draw[change] (rev4) to (rev9);
		\draw[change] (rev5) to (rev8);
		\draw[change] (rev6) to (rev7);
		\draw[merge] (rev7) to (rev9);
		\draw[change] (rev8) to (rev10);
		\draw[merge] (rev9) to (rev10);
		\draw[change] (rev9) to (rev11);
		\draw[merge] (rev10) to node {merge} (rev11);
		\draw[change] (rev10) to (rev13);
		\draw[change] (rev11) to (rev12);
	\end{tikzpicture}
}

% OTHER COMMANDS

\usetikzlibrary{snakes}
\newcommand{\tpkt}[1]{\tikz[remember picture] \coordinate(#1);}
\newcommand{\myunderline}[2]{
	\begin{tikzpicture}[remember picture,overlay]
		\foreach \x in {#1} {
			\node[yshift=.5mm] (x1) at (\x 1) {};
			\node[yshift=.5mm] (x2) at (\x 2) {};
			\draw[#2,thick,snake=snake,segment amplitude=.2mm,segment length=1mm] (x1.south) -- (x2.south);
		}
	\end{tikzpicture}
}
\newcommand{\errorunderline}[1]{\myunderline{#1}{red}}
\newcommand{\warningunderline}[1]{\myunderline{#1}{orange}}
\newcommand{\infounderline}[1]{\myunderline{#1}{blue}}
